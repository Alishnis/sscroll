<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartScroll - –õ–µ–Ω—Ç–∞</title>
    
    <!-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —è—Ä–∫–æ—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ -->
    <script src="brightness-monitor.js"></script>
    
    <!-- –ï–¥–∏–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <link rel="stylesheet" href="navbar.css">
    <script src="navbar.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        
        .search-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }
        
        .feed-container {
            margin-top: 80px;
            padding: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .video-card {
            background: #1a1a1a;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .video-player {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
        }
        
        .video-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .video-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 10;
        }
        
        .video-info {
            padding: 20px;
        }
        
        .video-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .tag {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .tag.video {
            background: #ff4444;
        }
        
        .tag.education {
            background: #4CAF50;
        }
        
        .video-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .video-channel {
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .video-description {
            color: #ccc;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .video-stats {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #888;
            font-size: 14px;
        }
        
        .clickable-stat {
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 8px;
        }
        
        .clickable-stat:hover {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            transform: translateY(-1px);
        }
        
        .stat-icon {
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #888;
        }
        
        .error, .no-results {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #ff6b6b;
        }
        
        .error div, .no-results div {
            margin-bottom: 10px;
        }
        
        .search-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .search-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .search-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .popular-tags {
            margin-bottom: 20px;
        }
        
        .tags-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag-btn {
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: none;
        }
        
        .tag-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .search-btn-main {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .search-btn-main:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ */
        .summary-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .summary-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .summary-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .summary-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .summary-text {
            color: #333;
            line-height: 1.8;
            font-size: 1rem;
        }
        
        .summary-text strong {
            color: #667eea;
            font-weight: 600;
        }
        
        .summary-text ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .summary-text li {
            margin: 5px 0;
        }
        
        .quiz-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .quiz-button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .quiz-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .quiz-content {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .quiz-question {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .quiz-question h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .quiz-options {
            list-style: none;
            padding: 0;
        }
        
            .quiz-options li {
                padding: 8px 12px;
                margin: 5px 0;
                background: #000000;
                color: white;
                border-radius: 5px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .quiz-options li:hover {
                background: #333333;
            }

            .quiz-options li.selected {
                background: #4CAF50;
                color: white;
            }
        
        .loading-summary {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .bottom-navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #f5f5f5;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            max-width: 80px;
            border-radius: 8px;
            min-width: 60px;
        }

        .nav-item:hover {
            background: #e8e8e8;
        }

        .nav-item.active {
            background: #667eea;
            color: white;
        }

        .nav-item.active .nav-icon {
            color: white;
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 3px;
            color: #666;
        }

        .nav-label {
            font-size: 11px;
            color: #666;
            text-align: center;
        }

        .nav-item.active .nav-label {
            color: white;
        }

        /* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª—Å—è —Å –Ω–∞–≤–±–∞—Ä–æ–º */
        .feed-container {
            padding-bottom: 80px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>–õ–µ–Ω—Ç–∞</h1>
        <button class="search-btn" onclick="openSearch()" title="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º">
            üîç
        </button>
    </div>
    
    <div class="feed-container" id="feedContainer">
        <div class="loading">
            <div>üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ...</div>
        </div>
    </div>
    
    <!-- Search Overlay -->
    <div class="search-overlay" id="searchOverlay">
        <div class="search-panel">
            <div class="search-header">
                <h2 class="search-title">–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º</h2>
                <button class="close-btn" onclick="closeSearch()">√ó</button>
            </div>
            
            <input type="text" class="search-input" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞...">
            
            <div class="popular-tags">
                <h3 class="tags-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏:</h3>
                <div class="tags-container">
                    <button class="tag-btn" onclick="searchTag('programming')">#programming</button>
                    <button class="tag-btn" onclick="searchTag('coding')">#coding</button>
                    <button class="tag-btn" onclick="searchTag('tutorial')">#tutorial</button>
                    <button class="tag-btn" onclick="searchTag('learn')">#learn</button>
                    <button class="tag-btn" onclick="searchTag('funny')">#funny</button>
                    <button class="tag-btn" onclick="searchTag('gaming')">#gaming</button>
                    <button class="tag-btn" onclick="searchTag('music')">#music</button>
                    <button class="tag-btn" onclick="searchTag('cooking')">#cooking</button>
                </div>
            </div>
            
            <button class="search-btn-main" onclick="performSearch()">–ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç</button>
        </div>
    </div>
    
    <!-- Summary Modal -->
    <div class="summary-modal" id="summaryModal">
        <div class="summary-content">
            <div class="summary-header">
                <h2 class="summary-title">–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≤–∏–¥–µ–æ</h2>
                <button class="summary-close" onclick="closeSummary()">√ó</button>
            </div>
            <div id="summaryContent">
                <div class="loading-summary">
                    <div class="loading-spinner"></div>
                    <div>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∏–¥–µ–æ –∏ —Å–æ–∑–¥–∞–µ–º –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ï–¥–∏–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="bottom-navbar">
        <div class="nav-item" data-page="feed" onclick="handleNavClick(event, 'feed')">
            <div class="nav-icon">üì±</div>
            <div class="nav-label">–õ–µ–Ω—Ç–∞</div>
        </div>
        <div class="nav-item" data-page="posts" onclick="handleNavClick(event, 'posts')">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">–ü–æ—Å—Ç—ã</div>
        </div>
        <div class="nav-item" data-page="eye-health" onclick="handleNavClick(event, 'eye-health')">
            <div class="nav-icon">üëÅÔ∏è</div>
            <div class="nav-label">–ì–ª–∞–∑–∞</div>
        </div>
        <div class="nav-item" data-page="conference" onclick="handleNavClick(event, 'conference')">
            <div class="nav-icon">üìπ</div>
            <div class="nav-label">–í–∏–¥–µ–æ</div>
        </div>
        <div class="nav-item" data-page="settings" onclick="handleNavClick(event, 'settings')">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>
    </div>

    <script>
        // API –∫–ª—é—á–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å)
        const YOUTUBE_API_KEY = 'YOUR_YOUTUBE_API_KEY';
        const OPENAI_API_KEY = 'YOUR_OPENAI_API_KEY';
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π mock —Ä–µ–∂–∏–º (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        const FORCE_MOCK_MODE = false;
        
        let currentQuery = 'programming';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadVideos(currentQuery);
        });
        
        async function loadVideos(query) {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '<div class="loading"><div>üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ...</div></div>';

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π mock —Ä–µ–∂–∏–º
            if (FORCE_MOCK_MODE) {
                console.log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π mock —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω');
                loadMockVideos(query);
                return;
            }

            try {
                // –†–µ–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ YouTube API
                const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=10&key=${YOUTUBE_API_KEY}`;
                
                console.log('Searching with URL:', searchUrl);
                console.log('API Key:', YOUTUBE_API_KEY);
                
                const response = await fetch(searchUrl, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                
                const searchData = await response.json();
                
                if (!searchData.items || searchData.items.length === 0) {
                    feedContainer.innerHTML = '<div class="no-results"><div>üòî –í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div><div>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å</div></div>';
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                const videoIds = searchData.items.map(item => item.id.videoId).join(',');
                const statsUrl = `https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${videoIds}&key=${YOUTUBE_API_KEY}`;
                
                const statsResponse = await fetch(statsUrl);
                const statsData = await statsResponse.json();
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const videosWithStats = searchData.items.map(video => {
                    const stats = statsData.items.find(item => item.id === video.id.videoId);
                    return {
                        id: video.id,
                        snippet: video.snippet,
                        statistics: stats ? stats.statistics : null
                    };
                });
                
                displayVideos(videosWithStats);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', error);
                
                // –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º mock –¥–∞–Ω–Ω—ã–µ
                if (error.message.includes('403') && error.message.includes('quota')) {
                    console.log('–ö–≤–æ—Ç–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º mock –¥–∞–Ω–Ω—ã–µ...');
                    loadMockVideos(query);
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ
                let errorMessage = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ';
                if (error.message.includes('400')) {
                    errorMessage += '<br>üîë –ü—Ä–æ–±–ª–µ–º–∞ —Å API –∫–ª—é—á–æ–º YouTube';
                } else if (error.message.includes('403')) {
                    if (error.message.includes('quota')) {
                        errorMessage += '<br>üìä –ü—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞ YouTube API';
                        errorMessage += '<br>‚è∞ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π API –∫–ª—é—á';
                    } else {
                        errorMessage += '<br>üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω –∫ YouTube API';
                    }
                } else if (error.message.includes('CORS')) {
                    errorMessage += '<br>üåê –ü—Ä–æ–±–ª–µ–º–∞ —Å CORS';
                } else {
                    errorMessage += '<br>üì° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É';
                }
                
                feedContainer.innerHTML = `<div class="error"><div>${errorMessage}</div><div>–î–µ—Ç–∞–ª–∏: ${error.message}</div></div>`;
            }
        }
        
        // Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∫–≤–æ—Ç—ã
        function loadMockVideos(query) {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '<div class="loading"><div>üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-–≤–∏–¥–µ–æ...</div></div>';
            
            // Mock –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–ø—É–ª—è—Ä–Ω—ã–º–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –≤–∏–¥–µ–æ
            const mockVideos = [
                {
                    id: { videoId: 'dQw4w9WgXcQ' },
                    snippet: {
                        title: 'üéì –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö - –ü–æ–ª–Ω—ã–π –∫—É—Ä—Å',
                        description: '–ò–∑—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å –Ω—É–ª—è. –≠—Ç–æ—Ç –∫—É—Ä—Å –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.',
                        thumbnails: {
                            medium: { url: 'https://img.youtube.com/vi/dQw4w9WgXcQ/mqdefault.jpg' }
                        },
                        channelTitle: 'Tech Education'
                    },
                    statistics: { viewCount: '1250000', likeCount: '45000' }
                },
                {
                    id: { videoId: 'jNQXAC9IVRw' },
                    snippet: {
                        title: 'üöÄ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ',
                        description: '–í–≤–µ–¥–µ–Ω–∏–µ –≤ –º–∏—Ä –ò–ò –∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏ –∫–µ–π—Å—ã.',
                        thumbnails: {
                            medium: { url: 'https://img.youtube.com/vi/jNQXAC9IVRw/mqdefault.jpg' }
                        },
                        channelTitle: 'AI Academy'
                    },
                    statistics: { viewCount: '890000', likeCount: '32000' }
                },
                {
                    id: { videoId: 'L_jWHffIx5E' },
                    snippet: {
                        title: 'üíª –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: HTML, CSS, JavaScript',
                        description: '–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ–±-—Å–∞–π—Ç–æ–≤. –û—Ç –æ—Å–Ω–æ–≤ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ç–µ—Ö–Ω–∏–∫.',
                        thumbnails: {
                            medium: { url: 'https://img.youtube.com/vi/L_jWHffIx5E/mqdefault.jpg' }
                        },
                        channelTitle: 'Web Dev Master'
                    },
                    statistics: { viewCount: '2100000', likeCount: '78000' }
                },
                {
                    id: { videoId: '9bZkp7q19f0' },
                    snippet: {
                        title: 'üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å Python –∏ Pandas',
                        description: '–ò–∑—É—á–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Python. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.',
                        thumbnails: {
                            medium: { url: 'https://img.youtube.com/vi/9bZkp7q19f0/mqdefault.jpg' }
                        },
                        channelTitle: 'Data Science Pro'
                    },
                    statistics: { viewCount: '1560000', likeCount: '56000' }
                },
                {
                    id: { videoId: 'fJ9rUzIMcZQ' },
                    snippet: {
                        title: 'üîí –ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤',
                        description: '–û—Å–Ω–æ–≤—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –æ—Ç –∞—Ç–∞–∫ –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.',
                        thumbnails: {
                            medium: { url: 'https://img.youtube.com/vi/fJ9rUzIMcZQ/mqdefault.jpg' }
                        },
                        channelTitle: 'Security Expert'
                    },
                    statistics: { viewCount: '980000', likeCount: '41000' }
                }
            ];
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ mock —Ä–µ–∂–∏–º–µ
            const mockNotice = document.createElement('div');
            mockNotice.className = 'mock-notice';
            mockNotice.innerHTML = `
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px; border-radius: 5px; text-align: center;">
                    <strong>üìä –î–µ–º–æ-—Ä–µ–∂–∏–º</strong><br>
                    YouTube API –∫–≤–æ—Ç–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∞. –ü–æ–∫–∞–∑–∞–Ω—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ.<br>
                    <small>–î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á –≤ Google Cloud Console</small>
                </div>
            `;
            feedContainer.innerHTML = '';
            feedContainer.appendChild(mockNotice);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º mock –≤–∏–¥–µ–æ
            displayVideos(mockVideos);
        }
        
        function displayVideos(videos) {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '';
            
            videos.forEach(video => {
                const videoCard = createVideoCard(video);
                feedContainer.appendChild(videoCard);
            });
        }
        
        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            
            const videoId = video.id.videoId;
            const snippet = video.snippet;
            const statistics = video.statistics;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const views = statistics ? formatNumber(statistics.viewCount) : 'N/A';
            const likes = statistics ? formatNumber(statistics.likeCount) : 'N/A';
            
            card.innerHTML = `
                <div class="video-player">
                    <iframe 
                        class="video-iframe"
                        src="https://www.youtube.com/embed/${videoId}?autoplay=0&controls=1&rel=0&modestbranding=1&showinfo=0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                    <div class="video-overlay">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="background: #ff0000; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">YOUTUBE</span>
                            <span>${snippet.title}</span>
                        </div>
                    </div>
                </div>
                <div class="video-info">
                    <div class="video-tags">
                        <span class="tag video">–í–∏–¥–µ–æ</span>
                        <span class="tag education">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</span>
                        <span class="tag">#${currentQuery}</span>
                    </div>
                    <div class="video-title">${snippet.title}</div>
                    <div class="video-channel">${snippet.channelTitle}</div>
                    <div class="video-description">${snippet.description.substring(0, 150)}...</div>
                    <div class="video-stats">
                        <div class="stat">
                            <span class="stat-icon">‚ù§Ô∏è</span>
                            <span>${likes}</span>
                        </div>
                        <div class="stat">
                            <span class="stat-icon">üëÅÔ∏è</span>
                            <span>${views}</span>
                        </div>
                        <div class="stat clickable-stat" onclick="summarizeVideo('${videoId}', '${snippet.title}')">
                            <span class="stat-icon">üìù</span>
                            <span>–ö—Ä–∞—Ç–∫–æ–µ</span>
                        </div>
                        <div class="stat clickable-stat" onclick="generateQuiz('${videoId}', '${snippet.title}')">
                            <span class="stat-icon">üß†</span>
                            <span>–ö–≤–∏–∑</span>
                        </div>
                        <div class="stat clickable-stat" onclick="openOriginalVideo('${videoId}')">
                            <span class="stat-icon">üîó</span>
                            <span>–ò—Å—Ç–æ—á–Ω–∏–∫</span>
                        </div>
                        <div class="stat clickable-stat" onclick="shareVideo('${videoId}', '${snippet.title}')">
                            <span class="stat-icon">üì§</span>
                            <span>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function formatNumber(num) {
            if (!num) return '0';
            
            const number = parseInt(num);
            if (number >= 1000000) {
                return (number / 1000000).toFixed(1) + 'M';
            } else if (number >= 1000) {
                return (number / 1000).toFixed(1) + 'K';
            } else {
                return number.toString();
            }
        }
        
        function openSearch() {
            document.getElementById('searchOverlay').style.display = 'flex';
            document.getElementById('searchInput').focus();
        }
        
        function closeSearch() {
            document.getElementById('searchOverlay').style.display = 'none';
        }
        
        function searchTag(tag) {
            document.getElementById('searchInput').value = tag;
        }
        
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                return;
            }
            
            currentQuery = query;
            closeSearch();
            loadVideos(query);
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ Enter
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –ø–∞–Ω–µ–ª–∏
        document.getElementById('searchOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSearch();
            }
        });
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–∏–¥–µ–æ
        
        // –û—Ç–∫—Ä—ã—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ –Ω–∞ YouTube
        function openOriginalVideo(videoId) {
            const youtubeUrl = `https://www.youtube.com/watch?v=${videoId}`;
            window.open(youtubeUrl, '_blank');
        }
        
        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤–∏–¥–µ–æ
        function shareVideo(videoId, title) {
            const youtubeUrl = `https://www.youtube.com/watch?v=${videoId}`;
            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: youtubeUrl
                });
            } else {
                // Fallback - –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                navigator.clipboard.writeText(youtubeUrl).then(() => {
                    alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                });
            }
        }
        
        // –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ
        async function summarizeVideo(videoId, title) {
            document.getElementById('summaryModal').style.display = 'flex';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å—É–±—Ç–∏—Ç—Ä—ã –≤–∏–¥–µ–æ
                const captions = await getVideoCaptions(videoId, title);
                
                if (captions) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é –≤ OpenAI
                    const summary = await summarizeWithOpenAI(captions, title);
                    displaySummary(summary);
                } else {
                    displaySummary('–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å—É–±—Ç–∏—Ç—Ä—ã –¥–ª—è —ç—Ç–æ–≥–æ –≤–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –≤–∏–¥–µ–æ.');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏:', error);
                displaySummary('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫—Ä–∞—Ç–∫–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –≤–∏–¥–µ–æ
        async function getVideoCaptions(videoId, title) {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º YouTube API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—É–±—Ç–∏—Ç—Ä–∞—Ö
                const response = await fetch(`https://www.googleapis.com/youtube/v3/captions?part=snippet&videoId=${videoId}&key=${YOUTUBE_API_KEY}`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
                    const videoResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key=${YOUTUBE_API_KEY}`);
                    const videoData = await videoResponse.json();
                    
                    if (videoData.items && videoData.items.length > 0) {
                        const video = videoData.items[0];
                        const snippet = video.snippet;
                        const statistics = video.statistics;
                        
                        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        const context = `
–¢–µ–º–∞ –≤–∏–¥–µ–æ: ${snippet.title}
–ö–∞–Ω–∞–ª: ${snippet.channelTitle}
–û–ø–∏—Å–∞–Ω–∏–µ: ${snippet.description}
–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: ${statistics.viewCount}
–õ–∞–π–∫–∏: ${statistics.likeCount}
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${snippet.duration || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã –≤ –≤–∏–¥–µ–æ:
- ${snippet.title.toLowerCase()}
- –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
- –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

–≠—Ç–æ –≤–∏–¥–µ–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Ç–µ–º–µ "${snippet.title}". –û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–∏, –≤–∏–¥–µ–æ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –ø–æ –¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ.
                        `;
                        
                        return context.trim();
                    }
                }
                
                // –ï—Å–ª–∏ —Å—É–±—Ç–∏—Ç—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, —Å–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è
                return `–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ "${title}":\n\n–≠—Ç–æ –≤–∏–¥–µ–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Ç–µ–º–µ "${title}". –í–∏–¥–µ–æ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –ø–æ –¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ. –ö–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –ø—Ä–∏–º–µ—Ä—ã –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã.`;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤:', error);
                return `–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ "${title}":\n\n–≠—Ç–æ –≤–∏–¥–µ–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Ç–µ–º–µ "${title}". –í–∏–¥–µ–æ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –ø–æ –¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ.`;
            }
        }
        
        // –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OpenAI
        async function summarizeWithOpenAI(transcript, title) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: '–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫—Ä–∞—Ç–∫–∏—Ö —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–∏–¥–µ–æ. –°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –≤ 5-7 –ø—É–Ω–∫—Ç–æ–≤, –≤—ã–¥–µ–ª–∏–≤ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –∫–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è.'
                            },
                            {
                                role: 'user',
                                content: `–°–æ–∑–¥–∞–π –ø–æ–¥—Ä–æ–±–Ω–æ–µ –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ "${title}" –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:\n\n${transcript}\n\n–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ –ø—É–Ω–∫—Ç–∞–º —Å —ç–º–æ–¥–∑–∏ –∏ –≤—ã–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.`
                            }
                        ],
                        max_tokens: 800,
                        temperature: 0.4
                    })
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á OpenAI. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.');
                    } else if (response.status === 429) {
                        throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI API.');
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                }
                
                const data = await response.json();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞
                if (data && data.choices && data.choices.length > 0 && data.choices[0].message) {
                    return data.choices[0].message.content;
                } else {
                    console.error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ OpenAI:', data);
                    return '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –≤–∏–¥–µ–æ.';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ OpenAI API:', error);
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ API
                return generateStructuredSummary(title);
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
        function generateStructuredSummary(title) {
            const topics = {
                'programming': {
                    main: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
                    concepts: ['–ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö', '–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π'],
                    examples: ['–°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π', '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π', '–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö'],
                    conclusion: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ –Ω–∞–≤—ã–∫, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏'
                },
                'coding': {
                    main: '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    concepts: ['–ß–∏—Å—Ç—ã–π –∫–æ–¥', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', '–û—Ç–ª–∞–¥–∫–∞'],
                    examples: ['–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π', '–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫', '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'],
                    conclusion: '–•–æ—Ä–æ—à–∏–π –∫–æ–¥ - —ç—Ç–æ —á–∏—Ç–∞–µ–º—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∫–æ–¥'
                },
                'tutorial': {
                    main: '–û–±—É—á–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç',
                    concepts: ['–ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ', '–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è', '–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏'],
                    examples: ['–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤', '–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á', '–ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π'],
                    conclusion: '–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Ä–ø–µ–Ω–∏—è –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏'
                },
                'javascript': {
                    main: 'JavaScript —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
                    concepts: ['ES6+ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å', '–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', 'DOM –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏'],
                    examples: ['–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∞–π—Ç–æ–≤', '–†–∞–±–æ—Ç–∞ —Å API', '–§—Ä–µ–π–º–≤–æ—Ä–∫–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏'],
                    conclusion: 'JavaScript - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —è–∑—ã–∫ –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏'
                },
                'python': {
                    main: 'Python –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
                    concepts: ['–°–∏–Ω—Ç–∞–∫—Å–∏—Å Python', '–û–û–ü', '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏'],
                    examples: ['–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö', '–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞', '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è'],
                    conclusion: 'Python - –º–æ—â–Ω—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π –≤ –∏–∑—É—á–µ–Ω–∏–∏ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è'
                }
            };
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            let topic = 'programming';
            const titleLower = title.toLowerCase();
            if (titleLower.includes('javascript')) topic = 'javascript';
            else if (titleLower.includes('python')) topic = 'python';
            else if (titleLower.includes('coding')) topic = 'coding';
            else if (titleLower.includes('tutorial')) topic = 'tutorial';
            
            const data = topics[topic];
            
            return `üéØ **${data.main}**

üìö **–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
${data.concepts.map(concept => `‚Ä¢ ${concept}`).join('\n')}

üí° **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã:**
${data.examples.map(example => `‚Ä¢ ${example}`).join('\n')}

üéØ **–ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥:**
${data.conclusion}

---
*üìù –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç AI-—Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –≤–∏–¥–µ–æ.*`;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
        function displaySummary(summary) {
            document.getElementById('summaryContent').innerHTML = `
                <div class="summary-text">${summary.replace(/\n/g, '<br>')}</div>
            `;
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
        function closeSummary() {
            document.getElementById('summaryModal').style.display = 'none';
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('summaryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSummary();
            }
        });
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∏–∑–∞
        async function generateQuiz(videoId, title) {
            console.log('–§—É–Ω–∫—Ü–∏—è generateQuiz –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è –≤–∏–¥–µ–æ:', title);
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–≤–∏–∑–∞
            const quizModal = document.createElement('div');
            quizModal.className = 'summary-modal';
            quizModal.id = 'quizModal';
            quizModal.style.display = 'flex';
            
            quizModal.innerHTML = `
                <div class="summary-content">
                    <div class="summary-header">
                        <h2 class="summary-title">üß† –ö–≤–∏–∑ –ø–æ –≤–∏–¥–µ–æ</h2>
                        <button class="summary-close" onclick="closeQuiz()">√ó</button>
                    </div>
                    <div id="quizContent">
                        <div class="loading-summary">
                            <div class="loading-spinner"></div>
                            <div>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –≤–∏–¥–µ–æ...</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(quizModal);
            
            try {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–≤–∏–∑ —á–µ—Ä–µ–∑ OpenAI –∏–ª–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π
                const quiz = await generateQuizWithOpenAI(title);
                displayQuiz(quiz);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–≤–∏–∑–∞:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–≤–∏–∑
                const demoQuiz = generateDemoQuiz();
                displayQuiz(demoQuiz);
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–≤–∏–∑–∞
        function closeQuiz() {
            const quizModal = document.getElementById('quizModal');
            if (quizModal) {
                document.body.removeChild(quizModal);
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
        function navigateTo(section) {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
            event.target.closest('.nav-item').classList.add('active');
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
            switch(section) {
                case 'feed':
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –õ–µ–Ω—Ç—É');
                    // –£–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–µ–Ω—Ç—ã - –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                    loadVideos(currentQuery);
                    break;
                case 'posts':
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ü–æ—Å—Ç—ã');
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å—Ç–æ–≤
                    window.location.href = 'posts.html';
                    break;
                case 'groups':
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ì—Ä—É–ø–ø—ã');
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥—Ä—É–ø–ø
                    window.location.href = 'groups.html';
                    break;
                case 'settings':
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏');
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    window.location.href = 'posts.html#settings';
                    break;
                case 'profile':
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ü—Ä–æ—Ñ–∏–ª—å');
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è
                    window.location.href = 'profile.html';
                    break;
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–≤–∏–∑–∞ —á–µ—Ä–µ–∑ OpenAI
        async function generateQuizWithOpenAI(title) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: '–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–≤–∏–∑–æ–≤. –°–æ–∑–¥–∞–π 5 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤ –∫–∞–∂–¥—ã–π –ø–æ —Ç–µ–º–µ –≤–∏–¥–µ–æ. –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: –æ—Ç –±–∞–∑–æ–≤—ã—Ö –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö. –û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.'
                            },
                            {
                                role: 'user',
                                content: `–°–æ–∑–¥–∞–π –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–≤–∏–∑ –∏–∑ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ–º–µ "${title}". –ö–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞, –≥–¥–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –æ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Ç–µ–º—ã: —Ç–µ–æ—Ä–∏—é, –ø—Ä–∞–∫—Ç–∏–∫—É, –ø—Ä–∏–º–µ—Ä—ã. –í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON: {"questions": [{"question": "—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞", "options": ["–≤–∞—Ä–∏–∞–Ω—Ç1", "–≤–∞—Ä–∏–∞–Ω—Ç2", "–≤–∞—Ä–∏–∞–Ω—Ç3", "–≤–∞—Ä–∏–∞–Ω—Ç4"], "correct": 0, "explanation": "–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞"}]}`
                            }
                        ],
                        max_tokens: 1500,
                        temperature: 0.2,
                        response_format: {"type": "json_object"}
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data && data.choices && data.choices.length > 0 && data.choices[0].message) {
                    const content = data.choices[0].message.content;
                    try {
                        const parsed = JSON.parse(content);
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ
                        if (parsed.questions && Array.isArray(parsed.questions)) {
                            return {
                                questions: parsed.questions.map((q, index) => ({
                                    question: q.question || `–í–æ–ø—Ä–æ—Å ${index + 1}`,
                                    options: q.options || ["–í–∞—Ä–∏–∞–Ω—Ç 1", "–í–∞—Ä–∏–∞–Ω—Ç 2", "–í–∞—Ä–∏–∞–Ω—Ç 3", "–í–∞—Ä–∏–∞–Ω—Ç 4"],
                                    correct: q.correct || 0,
                                    explanation: q.explanation || "–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ"
                                }))
                            };
                        } else {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–≤–∏–∑–∞');
                        }
                    } catch (parseError) {
                        console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –∫–≤–∏–∑–∞:', parseError);
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç –∫–≤–∏–∑–∞');
                    }
                } else {
                    throw new Error('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ OpenAI');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ OpenAI API –¥–ª—è –∫–≤–∏–∑–∞:', error);
                throw error;
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–≤–∏–∑–∞
        function generateDemoQuiz() {
            return {
                questions: [
                    {
                        question: "–ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏?",
                        options: ["Python", "JavaScript", "Java", "C++"],
                        correct: 1
                    },
                    {
                        question: "–ß—Ç–æ —Ç–∞–∫–æ–µ DOM –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏?",
                        options: ["–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö", "–û–±—ä–µ–∫—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞", "–°–µ—Ä–≤–µ—Ä", "–§—Ä–µ–π–º–≤–æ—Ä–∫"],
                        correct: 1
                    },
                    {
                        question: "–ö–∞–∫–æ–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –≤ JavaScript?",
                        options: ["setTimeout", "for loop", "if statement", "console.log"],
                        correct: 0
                    },
                    {
                        question: "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ API?",
                        options: ["Application Programming Interface", "Advanced Programming Interface", "Automated Programming Interface", "Application Process Interface"],
                        correct: 0
                    },
                    {
                        question: "–ö–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –∫–æ–¥–∞?",
                        options: ["Git", "Photoshop", "Excel", "Word"],
                        correct: 0
                    }
                ]
            };
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–≤–∏–∑–∞
        function displayQuiz(quiz) {
            const quizContent = document.getElementById('quizContent');
            
            let quizHTML = '<div class="quiz-content"><h3>üß† –ö–≤–∏–∑ –ø–æ –≤–∏–¥–µ–æ</h3>';
            
            quiz.questions.forEach((q, index) => {
                quizHTML += `
                    <div class="quiz-question">
                        <h4>–í–æ–ø—Ä–æ—Å ${index + 1}: ${q.question}</h4>
                        <ul class="quiz-options">
                            ${q.options.map((option, optIndex) => `
                                <li onclick="selectAnswer(${index}, ${optIndex}, ${q.correct})">${option}</li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            });
            
            quizHTML += '</div>';
            quizContent.innerHTML = quizHTML;
        }
        
        // –í—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞ –≤ –∫–≤–∏–∑–µ
        function selectAnswer(questionIndex, optionIndex, correctIndex) {
            const question = document.querySelectorAll('.quiz-question')[questionIndex];
            const options = question.querySelectorAll('.quiz-options li');
            
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
            options.forEach(opt => opt.classList.remove('selected', 'correct', 'incorrect'));
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
            options[optionIndex].classList.add('selected');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
            if (optionIndex === correctIndex) {
                options[optionIndex].classList.add('correct');
                options[optionIndex].style.background = '#4CAF50';
                options[optionIndex].style.color = 'white';
            } else {
                options[optionIndex].classList.add('incorrect');
                options[optionIndex].style.background = '#f44336';
                options[optionIndex].style.color = 'white';
                options[correctIndex].classList.add('correct');
                options[correctIndex].style.background = '#4CAF50';
                options[correctIndex].style.color = 'white';
            }
        }
    </script>
</body>
</html>
